# 高性能视频录制 App 需求文档

## 项目概述

### 项目名称
DualViewX - 横竖同拍视频录制应用

### 项目描述
基于 uni-app x 开发的高性能视频录制应用，核心功能是横向和竖向同时录制视频（横竖同拍），支持双摄同步录制、高帧率录制、实时色彩处理、滤镜效果等功能。

### 技术栈
- **前端框架**: uni-app x
- **原生插件**: 自定义原生插件（Android/iOS）
- **视频编码**: H.264/HEVC
- **音频编码**: AAC
- **开发语言**: TypeScript, UTS, Java/Kotlin (Android), Swift/Objective-C (iOS)

## 核心功能需求

### 1. 多摄同步录制
- **功能描述**: 同时使用前后摄像头进行多路视频录制
- **技术要求**:
  - 支持前后摄像头同时启动
  - 多摄画面同步，延迟控制在 16ms 以内（60fps）
  - 支持摄像头分辨率独立配置
  - 支持摄像头帧率独立设置
  - 支持四路同时录制时的资源分配优化

### 2. 四路同时录制功能
- **功能描述**: 同时录制四个视角的视频（前置横屏、前置竖屏、后置横屏、后置竖屏）
- **技术要求**:
  - 支持四路视频同时录制（4个视频文件）
  - 支持用户自定义配置录制组合：
    - 全四路录制（前置横+前置竖+后置横+后置竖）
    - 双路录制（前置横+后置竖 或 前置竖+后置横）
    - 单路录制（任意一路）
  - 四路视频独立存储，支持不同分辨率配置
  - 支持横竖屏自动适配
  - 录制过程中支持横竖屏切换
  - 性能自适应：根据设备性能自动调整录制路数

### 3. 高帧率录制
- **功能描述**: 支持高帧率视频录制
- **技术要求**:
  - 支持 60fps 或以上帧率录制
  - 支持 120fps 慢动作录制
  - 帧率稳定性要求：波动不超过 ±2fps
  - 支持不同帧率下的分辨率配置
  - 四路录制时支持帧率自适应（根据设备性能调整）

### 4. 实时色彩处理
- **功能描述**: 实时 Log/Flat 色彩模式处理
- **技术要求**:
  - 支持 Log 色彩模式（便于后期调色）
  - 支持 Flat 色彩模式（保留更多细节）
  - 实时色彩空间转换
  - 支持色彩配置文件导入/导出

### 5. 实时滤镜处理
- **功能描述**: 实时视频滤镜效果处理
- **技术要求**:
  - **曝光调整**: 支持 -3EV 到 +3EV 调整
  - **饱和度调整**: 支持 0-200% 调整
  - **对比度调整**: 支持 0-200% 调整
  - **白平衡调整**: 支持色温 2000K-8000K 调整
  - 实时预览效果
  - 支持滤镜预设保存/加载

### 6. 摄像头控制
- **功能描述**: 灵活的摄像头控制功能
- **技术要求**:
  - 支持前后摄像头快速切换
  - 支持摄像头对焦控制（手动/自动）
  - 支持变焦功能（数字变焦）
  - 支持闪光灯控制

### 7. 录制控制
- **功能描述**: 灵活的录制控制功能
- **技术要求**:
  - 支持录制开始/停止
  - 支持录制过程中暂停/继续
  - 支持分段录制
  - 录制状态实时显示

### 8. 音视频同步
- **功能描述**: 确保音视频完美同步
- **技术要求**:
  - 音视频同步精度控制在 40ms 以内
  - 支持音频采样率配置（44.1kHz/48kHz）
  - 支持音频比特率配置
  - 支持音频降噪处理

## 技术架构

### 1. 前端架构 (uni-app x)
```
src/
├── pages/           # 页面文件
├── components/      # 组件文件
├── plugins/         # 插件接口
├── utils/           # 工具函数
├── store/           # 状态管理
└── styles/          # 样式文件
```

### 2. 原生插件架构
```
native-plugin/
├── android/         # Android 原生代码
│   ├── src/main/java/
│   └── src/main/cpp/    # JNI 代码
├── ios/             # iOS 原生代码
│   ├── Classes/
│   └── Frameworks/
└── common/          # 通用接口定义
```

### 3. 核心模块设计
- **CameraManager**: 摄像头管理模块（支持多路摄像头管理）
- **VideoRecorder**: 视频录制模块（支持多路同时录制）
- **AudioRecorder**: 音频录制模块
- **FilterEngine**: 滤镜处理引擎（支持多路并行处理）
- **ColorProcessor**: 色彩处理模块（支持多路并行处理）
- **SyncController**: 音视频同步控制器（支持多路同步）
- **PerformanceMonitor**: 性能监控模块（实时监控资源使用）
- **ConfigManager**: 配置管理模块（录制组合配置）

## 性能要求

### 1. 帧率稳定性
- 目标帧率: 60fps
- 允许波动: ±2fps
- 丢帧率: < 1%
- 录制时长: 支持连续录制 30 分钟以上
- 四路录制时帧率自适应：根据设备性能自动调整到 30fps/60fps

### 2. 内存使用
- 应用内存占用: < 500MB（单路录制）
- 四路录制内存占用: < 1.5GB
- 峰值内存: < 2GB
- 内存泄漏: 0 容忍

### 3. CPU 使用率
- 正常录制: < 60%
- 四路录制: < 85%
- 高帧率录制: < 80%
- 后台处理: < 30%

### 4. 存储要求
- 支持外部存储
- 支持存储空间检查
- 支持录制质量自适应

## 设备兼容性

### 1. Android 设备
- **最低版本**: Android 7.0 (API 24)
- **推荐版本**: Android 10.0 (API 29) 以上
- **硬件要求**:
  - 双摄像头支持
  - 4GB RAM 以上
  - 64GB 存储空间以上
  - 支持 HEVC 硬件编码

### 2. iOS 设备
- **最低版本**: iOS 12.0
- **推荐版本**: iOS 14.0 以上
- **硬件要求**:
  - iPhone 7 以上
  - 4GB RAM 以上
  - 64GB 存储空间以上
  - 支持 HEVC 硬件编码

## 用户界面设计

### 1. 主界面
- 四路摄像头预览窗口（可配置显示路数）
- 录制控制按钮
- 录制组合选择器（全四路/双路/单路）
- 参数调节面板
- 状态显示区域
- 性能监控面板（实时显示CPU/内存使用率）

### 2. 设置界面
- 录制参数配置（分辨率、帧率、编码格式）
- 录制组合预设管理
- 滤镜预设管理
- 存储路径设置
- 性能监控面板
- 设备性能评估和推荐配置

### 3. 播放界面
- 多路视频播放器（支持四路同时播放）
- 多视角切换（前置横/前置竖/后置横/后置竖）
- 基础编辑功能
- 导出选项（支持单路或多路导出）
- 视频同步播放控制

## 开发计划

### 阶段一：基础架构搭建 (2周)
- [ ] uni-app x 项目初始化
- [ ] 原生插件框架搭建
- [ ] 基础 UI 界面开发
- [ ] 摄像头基础功能实现

### 阶段二：核心功能开发 (5周)
- [ ] 多摄同步录制功能
- [ ] 四路同时录制功能
- [ ] 录制组合配置功能
- [ ] 高帧率录制功能
- [ ] 音视频同步功能
- [ ] 性能自适应功能

### 阶段三：高级功能开发 (3周)
- [ ] 实时色彩处理
- [ ] 实时滤镜处理
- [ ] 摄像头控制功能
- [ ] 录制控制功能

### 阶段四：性能优化 (2周)
- [ ] 帧率稳定性优化
- [ ] 内存使用优化
- [ ] CPU 使用率优化
- [ ] 设备兼容性测试

### 阶段五：测试与发布 (1周)
- [ ] 功能测试
- [ ] 性能测试
- [ ] 兼容性测试
- [ ] 应用打包发布

## 风险评估

### 1. 技术风险
- **四路同步延迟**: 需要优化多路摄像头启动和同步机制
- **高帧率稳定性**: 需要平衡性能和质量
- **设备兼容性**: 不同设备性能差异较大
- **资源竞争**: 四路同时录制可能导致资源竞争和性能下降

### 2. 性能风险
- **内存泄漏**: 长时间录制可能导致内存问题
- **CPU 过载**: 四路同时录制可能超出设备性能
- **存储空间**: 四路高分辨率录制占用大量存储（单次录制可能产生4GB+文件）
- **电池消耗**: 四路同时录制会大幅增加电池消耗

### 3. 兼容性风险
- **Android 碎片化**: 不同厂商设备差异
- **iOS 版本差异**: 新老版本 API 兼容性
- **硬件差异**: 摄像头性能差异

## 验收标准

### 1. 功能验收
- [ ] 四路同时录制功能正常
- [ ] 录制组合配置功能正常
- [ ] 高帧率录制稳定
- [ ] 实时滤镜效果正常
- [ ] 音视频同步准确
- [ ] 性能自适应功能正常

### 2. 性能验收
- [ ] 帧率稳定性达标
- [ ] 内存使用在合理范围
- [ ] CPU 使用率可控
- [ ] 连续录制 30 分钟无问题

### 3. 兼容性验收
- [ ] 支持设备列表 90% 以上正常运行
- [ ] 主流设备性能表现良好
- [ ] 不同系统版本兼容

## 后期扩展

### 1. 功能扩展
- 支持更多视频格式
- 增加 AI 智能调色
- 支持云端存储
- 增加社交分享功能

### 2. 技术扩展
- 支持 8K 录制
- 增加 HDR 支持
- 支持多机位同步
- 增加实时流媒体功能

---

**文档版本**: v1.0  
**创建日期**: 2024年12月  
**最后更新**: 2024年12月  
**负责人**: 开发团队
